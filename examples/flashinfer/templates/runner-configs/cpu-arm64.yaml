matcherConfig:
  exactMatch: true
  labelMatchers:
    - [self-hosted, linux, arm64, cpu]
  priority: 1
fifo: true

runner_config:
  runner_os: linux
  runner_architecture: arm64
  runner_name_prefix: flashinfer-cpu-arm64-
  
  enable_organization_runners: true
  
  # Custom labels
  runner_extra_labels:
    - cpu
  
  enable_ephemeral_runners: false
  
  instance_types:
    - c6g.large
    - t4g.large
    - c6g.xlarge
  
  instance_target_capacity_type: spot
  instance_allocation_strategy: price-capacity-optimized
  enable_on_demand_failover_for_errors:
    - InsufficientInstanceCapacity
  
  # NOT setting create_service_linked_role_spot (already created by cpu-x64)
  
  runners_maximum_count: 5
  delay_webhook_event: 30
  scale_down_schedule_expression: "cron(*/5 * * * ? *)"
  minimum_running_time_in_minutes: 10
  runner_boot_time_in_minutes: 5
  
  # Use Ubuntu 22.04 ARM64 AMI
  ami:
    owners:
      - "099720109477"  # Canonical
    filter:
      name:
        - "ubuntu/images/hvm-ssd/ubuntu-jammy-22.04-arm64-server-*"
      state:
        - available
  
  block_device_mappings:
    - device_name: /dev/sda1
      volume_size: 100
      volume_type: gp3
      delete_on_termination: true
      encrypted: true
  
  enable_ssm_on_runners: true
  enable_cloudwatch_agent: true
  
  runner_log_files:
    - log_group_name: syslog
      prefix_log_group: true
      file_path: /var/log/syslog
      log_stream_name: "{instance_id}"
    - log_group_name: user_data
      prefix_log_group: true
      file_path: /var/log/user-data.log
      log_stream_name: "{instance_id}/user_data"
  
  userdata_post_install: |
    #!/bin/bash
    apt-get update
    apt-get install -y docker.io
    systemctl enable docker
    systemctl start docker
    usermod -aG docker ubuntu
